extern crate libc;

use self::libc::{uint8_t};

#[allow(non_camel_case_types)]
pub enum Pin {
    PI_GPIO_P1_03,
    PI_GPIO_P1_05,
    PI_GPIO_P1_07,
    PI_GPIO_P1_08,
    PI_GPIO_P1_10,
    PI_GPIO_P1_11,
    PI_GPIO_P1_12,
    PI_GPIO_P1_13,
    PI_GPIO_P1_15,
    PI_GPIO_P1_16,
    PI_GPIO_P1_18,
    PI_GPIO_P1_19,
    PI_GPIO_P1_21,
    PI_GPIO_P1_22,
    PI_GPIO_P1_23,
    PI_GPIO_P1_24,
    PI_GPIO_P1_26,
    PI_V2_GPIO_P1_03,
    PI_V2_GPIO_P1_05,
    PI_V2_GPIO_P1_07,
    PI_V2_GPIO_P1_08,
    PI_V2_GPIO_P1_10,
    PI_V2_GPIO_P1_11,
    PI_V2_GPIO_P1_12,
    PI_V2_GPIO_P1_13,
    PI_V2_GPIO_P1_15,
    PI_V2_GPIO_P1_16,
    PI_V2_GPIO_P1_18,
    PI_V2_GPIO_P1_19,
    PI_V2_GPIO_P1_21,
    PI_V2_GPIO_P1_22,
    PI_V2_GPIO_P1_23,
    PI_V2_GPIO_P1_24,
    PI_V2_GPIO_P1_26,
    PI_V2_GPIO_P1_29,
    PI_V2_GPIO_P1_31,
    PI_V2_GPIO_P1_32,
    PI_V2_GPIO_P1_33,
    PI_V2_GPIO_P1_35,
    PI_V2_GPIO_P1_36,
    PI_V2_GPIO_P1_37,
    PI_V2_GPIO_P1_38,
    PI_V2_GPIO_P1_40,
    PI_V2_GPIO_P5_03,
    PI_V2_GPIO_P5_04,
    PI_V2_GPIO_P5_05,
    PI_V2_GPIO_P5_06,
    PI_BPLUS_GPIO_J8_03,
    PI_BPLUS_GPIO_J8_05,
    PI_BPLUS_GPIO_J8_07,
    PI_BPLUS_GPIO_J8_08,
    PI_BPLUS_GPIO_J8_10,
    PI_BPLUS_GPIO_J8_11,
    PI_BPLUS_GPIO_J8_12,
    PI_BPLUS_GPIO_J8_13,
    PI_BPLUS_GPIO_J8_15,
    PI_BPLUS_GPIO_J8_16,
    PI_BPLUS_GPIO_J8_18,
    PI_BPLUS_GPIO_J8_19,
    PI_BPLUS_GPIO_J8_21,
    PI_BPLUS_GPIO_J8_22,
    PI_BPLUS_GPIO_J8_23,
    PI_BPLUS_GPIO_J8_24,
    PI_BPLUS_GPIO_J8_26,
    PI_BPLUS_GPIO_J8_29,
    PI_BPLUS_GPIO_J8_31,
    PI_BPLUS_GPIO_J8_32,
    PI_BPLUS_GPIO_J8_33,
    PI_BPLUS_GPIO_J8_35,
    PI_BPLUS_GPIO_J8_36,
    PI_BPLUS_GPIO_J8_37,
    PI_BPLUS_GPIO_J8_38,
    PI_BPLUS_GPIO_J8_40,
}

impl Pin {
    fn as_uint8_t(&self) -> uint8_t {
        match *self {
            Pin::PI_GPIO_P1_03 => 0, 
            Pin::PI_GPIO_P1_05 => 1,
            Pin::PI_GPIO_P1_07 => 4,
            Pin::PI_GPIO_P1_08 => 14,
            Pin::PI_GPIO_P1_10 => 15,
            Pin::PI_GPIO_P1_11 => 17,
            Pin::PI_GPIO_P1_12 => 18,
            Pin::PI_GPIO_P1_13 => 21,
            Pin::PI_GPIO_P1_15 => 22,
            Pin::PI_GPIO_P1_16 => 23,
            Pin::PI_GPIO_P1_18 => 24,
            Pin::PI_GPIO_P1_19 => 10,
            Pin::PI_GPIO_P1_21 => 9,
            Pin::PI_GPIO_P1_22 => 25,
            Pin::PI_GPIO_P1_23 => 11,
            Pin::PI_GPIO_P1_24 => 8,
            Pin::PI_GPIO_P1_26 => 7,
            Pin::PI_V2_GPIO_P1_03 => 2,
            Pin::PI_V2_GPIO_P1_05 => 3,
            Pin::PI_V2_GPIO_P1_07 => 4,
            Pin::PI_V2_GPIO_P1_08 => 14,
            Pin::PI_V2_GPIO_P1_10 => 15,
            Pin::PI_V2_GPIO_P1_11 => 17,
            Pin::PI_V2_GPIO_P1_12 => 18,
            Pin::PI_V2_GPIO_P1_13 => 27,
            Pin::PI_V2_GPIO_P1_15 => 22,
            Pin::PI_V2_GPIO_P1_16 => 23,
            Pin::PI_V2_GPIO_P1_18 => 24,
            Pin::PI_V2_GPIO_P1_19 => 10,
            Pin::PI_V2_GPIO_P1_21 => 9,
            Pin::PI_V2_GPIO_P1_22 => 25,
            Pin::PI_V2_GPIO_P1_23 => 11,
            Pin::PI_V2_GPIO_P1_24 => 8,
            Pin::PI_V2_GPIO_P1_26 => 7,
            Pin::PI_V2_GPIO_P1_29 => 5,
            Pin::PI_V2_GPIO_P1_31 => 6,
            Pin::PI_V2_GPIO_P1_32 => 12,
            Pin::PI_V2_GPIO_P1_33 => 13,
            Pin::PI_V2_GPIO_P1_35 => 19,
            Pin::PI_V2_GPIO_P1_36 => 16,
            Pin::PI_V2_GPIO_P1_37 => 26,
            Pin::PI_V2_GPIO_P1_38 => 20,
            Pin::PI_V2_GPIO_P1_40 => 21,
            Pin::PI_V2_GPIO_P5_03 => 28,
            Pin::PI_V2_GPIO_P5_04 => 29,
            Pin::PI_V2_GPIO_P5_05 => 30,
            Pin::PI_V2_GPIO_P5_06 => 31,
            Pin::PI_BPLUS_GPIO_J8_03 => 2,
            Pin::PI_BPLUS_GPIO_J8_05 => 3,
            Pin::PI_BPLUS_GPIO_J8_07 => 4,
            Pin::PI_BPLUS_GPIO_J8_08 => 14,
            Pin::PI_BPLUS_GPIO_J8_10 => 15,
            Pin::PI_BPLUS_GPIO_J8_11 => 17,
            Pin::PI_BPLUS_GPIO_J8_12 => 18,
            Pin::PI_BPLUS_GPIO_J8_13 => 27,
            Pin::PI_BPLUS_GPIO_J8_15 => 22,
            Pin::PI_BPLUS_GPIO_J8_16 => 23,
            Pin::PI_BPLUS_GPIO_J8_18 => 24,
            Pin::PI_BPLUS_GPIO_J8_19 => 10,
            Pin::PI_BPLUS_GPIO_J8_21 => 9,
            Pin::PI_BPLUS_GPIO_J8_22 => 25,
            Pin::PI_BPLUS_GPIO_J8_23 => 11,
            Pin::PI_BPLUS_GPIO_J8_24 => 8,
            Pin::PI_BPLUS_GPIO_J8_26 => 7,
            Pin::PI_BPLUS_GPIO_J8_29 => 5,
            Pin::PI_BPLUS_GPIO_J8_31 => 6,
            Pin::PI_BPLUS_GPIO_J8_32 => 12,
            Pin::PI_BPLUS_GPIO_J8_33 => 13,
            Pin::PI_BPLUS_GPIO_J8_35 => 19,
            Pin::PI_BPLUS_GPIO_J8_36 => 16,
            Pin::PI_BPLUS_GPIO_J8_37 => 26,
            Pin::PI_BPLUS_GPIO_J8_38 => 20,
            Pin::PI_BPLUS_GPIO_J8_40 => 21,
        }
    }
}

pub enum FunctionSelect {
    Input,
    Output,
    Alt0,
    Alt1,
    Alt2,
    Alt3,
    Alt4,
    Alt5,
    Mask,
}

impl FunctionSelect {
    fn as_uint8_t(&self) -> uint8_t {
        match *self {
        FunctionSelect::Input => 0b0000,
        FunctionSelect::Output => 0b0001,
        FunctionSelect::Alt0 => 0b0100,
        FunctionSelect::Alt1 => 0b0101,
        FunctionSelect::Alt2 => 0b0110,
        FunctionSelect::Alt3 => 0b0111,
        FunctionSelect::Alt4 => 0b0011,
        FunctionSelect::Alt5 => 0b0010,
        FunctionSelect::Mask => 0b0111,
        }
    }
}

pub fn write(pin: Pin, level: super::PinLevel) {
    unsafe { super::bcm2835_gpio_write(pin.as_uint8_t(), level.as_uint8_t()) };
}

pub fn read(pin: Pin) -> super::PinLevel {
    let level = unsafe { super::bcm2835_gpio_lev(pin.as_uint8_t()) };
    match level {
        0 => super::PinLevel::LOW,
        1 => super::PinLevel::HIGH,
        _ => panic!("Unexpected pin level on pin {}: {}", pin.as_uint8_t(), level),
    }
}

pub fn function_select(pin: Pin, mode: FunctionSelect) {
    unsafe { super::bcm2835_gpio_fsel(pin.as_uint8_t(), mode.as_uint8_t()) };
}